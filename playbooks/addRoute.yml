---
- name: Add Route To Ansible Host
  #hosts: 127.0.0.1
  hosts: 10.49.5.209
  connection: local
  vars:
    interface: placeholder
    mask: placeholder
    destination: placeholder
    route_action: placeholder
  gather_facts: false
  tasks:
    - name: Add Static Route 
      when: route_action == "add"
      register: addoutput
      expect:
        command: ssh -o StrictHostKeyChecking=no ubuntu@10.49.5.209 'sudo route add -net "{{ destination }}" netmask "{{ mask }}" gw "{{ interface }}"'
        responses: 
          (?i)password: "atomic"
      #shell: /sbin/route add -net "{{ destination }}" netmask "{{ mask }}" gw "{{ interface }}"
      ignore_errors: True

    - name: Add Static Route Error
      when: route_action == "add" and addoutput.rc != 0
      fail:
        msg: "ADD ROUTE FAILIED:"
      debug: var=addoutput.stdout_lines


    - name: Print Add Output
      when: route_action == "add" and addoutput.rc == 0
      debug: var=addoutput.stdout_lines

    - name: Delete Static Route 
      when: route_action == "delete"
      register: deloutput
      expect:
        command: ssh -o StrictHostKeyChecking=no ubuntu@10.49.5.209 'sudo route del -net "{{ destination }}" netmask "{{ mask }}" gw "{{ interface }}"'
        responses: 
          (?i)password: "atomic"
      #shell: /sbin/route del -net "{{ destination }}" netmask "{{ mask }}" gw "{{ interface }}"
      ignore_errors: True

    - name: Delete Static Route Error
      when: route_action == "delete" and deloutput.rc != 0
      fail:
        msg: "DELETE ROUTE FAILIED:"
      debug: var=deloutput.stdout_lines

    - name: Print Del Output
      when: route_action == "delete" and deloutput.rc == 0
      debug: var=deloutput.stdout_lines

    - name: List Static Routes 
      when: route_action == "list"
      register: listoutput
      expect:
        command: ssh -o StrictHostKeyChecking=no ubuntu@10.49.5.209 'route -n'
        responses: 
          (?i)password: "atomic"
      #shell: /sbin/route -n
      ignore_errors: True

    - name: Delete Static Route Error
      when: route_action == "list" and listoutput.rc != 0
      fail:
        msg: "DELETE ROUTE FAILIED:"
      debug: var=listoutput.stdout_lines

    - name: Print List Output
      when: route_action == "list" and listoutput.rc == 0
      debug: var=listoutput.stdout_lines

#    - name: Install pexpect
#      register: output
#      pip:
#        name: pexpect
#      become: yes